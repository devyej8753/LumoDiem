<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ÌÅ¥ÎûòÏä§ ÏÉÅÏÑ∏Ï°∞Ìöå</title>

<link rel="stylesheet" href="<c:url value='/chatcss/chat.css'/>">


</head>
<body>
<%@ include file="/views/include/nav.jsp" %>

<div id="colorlib-main">
  <section class="ftco-section ftco-no-pt ftco-no-pb">
    <div class="container">
      <div class="row d-flex">
        <div class="col-xl-8 py-5 px-md-5">
          <div class="row pt-md-4">

            <div class="klass_detail"
              style="
                max-width: 100%; 
                margin: 0 auto; 
                border: 1px solid #ddd; 
                border-radius: 10px; 
                padding: 20px; 
                box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
              ">
            <h3 style="text-align: center; margin-bottom: 20px;">ÌÅ¥ÎûòÏä§ ÏÉÅÏÑ∏ Ï†ïÎ≥¥</h3>
				
              <c:choose>
                <c:when test="${klass.accountNo eq account.accountNo or account.accountGrade eq 'A'}">
                	 <!-- Ï∂îÍ∞Ä -->
	                  <div style="text-align: right; margin-bottom: 10px;">
	                    <a href="/klassBoardUpdate?klass_no=${klass.klassNo}" style="text-decoration: none;">
	                      <button type="button" id="updateBtn" name="updateBtn"
	                        style="background: #D1B5E0; color: white; border: none; 
	                               padding: 8px 12px; border-radius: 5px; cursor: pointer;">
	                        ÏàòÏ†ï
	                      </button>
	                    </a>
	                    <button type="button" id="deleteBtn" name="deleteBtn"
	                      style="background: #FF6058; color: white; border: none; 
	                             padding: 8px 12px; border-radius: 5px; cursor: pointer;">
	                      ÏÇ≠Ï†ú
	                    </button>
	                  </div>
                </c:when>
              </c:choose>

              <input type="hidden" value="${klass.klassNo}" name="klass_no">

              <ul style="list-style: none; padding: 0;">
                <li style="text-align: center; margin-bottom: 20px;">
                  <c:choose>
					<c:when test="${not empty klassAttach}">
						<c:forEach var="list" varStatus="vs" items="${klassAttach }">
				          <img alt="ÏÇ¨ÏßÑ" src="<%=request.getContextPath()%>/klassFilePath?attach_no=${list.attachNo}" 
				          style="max-width: 100%; max-height: 100%;" >
						</c:forEach>
					</c:when>
					<c:otherwise>
						<img alt="Ïç∏ÎÑ§Ïùº" src="/views/mainpage/thumbnail.jpg" style="height: 244px; width:244px;">
					</c:otherwise>
				</c:choose>
                </li>
                <li>
                  <table style="width: 100%; border-collapse: collapse; ">
                    <tr style="border-bottom: 1px solid #ddd;">
                      <th style="font-weight: bold; padding: 8px;">ÌÅ¥ÎûòÏä§Î™Ö</th>
                      <td style="padding: 8px;">${klass.klassName}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #ddd;">
                      <th style="font-weight: bold; padding: 8px;">Ï£ºÏµúÏûê</th>
                      <td style="padding: 8px;">${klass.accountNickname}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #ddd;">
                      <th style="font-weight: bold; padding: 8px;">ÏùºÏ†ï</th>
                      <td style="padding: 8px;">
                        <c:forEach var="li" items="${klassDate}">
                          ${fn:substring(li.klassStart,0,10)}<br>
                        </c:forEach>
                      </td>
                    </tr>
                    <tr style="border-bottom: 1px solid #ddd;">
                      <th style="font-weight: bold; padding: 8px;">ÏãúÍ∞Ñ</th>
                      <td style="padding: 8px;">
                        <c:forEach var="li" items="${klassDate}">
                          ${fn:substring(li.klassStart,11,19)}<br>
                        </c:forEach>
                      </td>
                    </tr>
                    <tr style="border-bottom: 1px solid #ddd;">
                      <th style="font-weight: bold; padding: 8px;">ÏµúÎåÄ(ÏòàÏïΩÍ∞ÄÎä•)</th>
                      <td style="padding: 8px;">
                        <c:forEach var="li" items="${klassDate}">
                          ${klass.klassMax}Î™Ö (${klass.klassMax - li.klassCount}Î™Ö)<br>
                        </c:forEach>
                      </td>
                    </tr>
                    <tr style="border-bottom: 1px solid #ddd;">
                      <th style="font-weight: bold; padding: 8px;">Ï£ºÏÜå</th>
                      <td style="padding: 8px;">${klass.klassAddress}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #ddd;">
                      <th style="font-weight: bold; padding: 8px;">ÏàòÏóÖÎ£å</th>
                      <td style="padding: 8px;">${klass.klassPrice}Ïõê</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #ddd;">
                      <th style="font-weight: bold; padding: 8px;">ÏûëÏÑ±Ïùº</th>
                      <td style="padding: 8px;">${klass.klassRegDate}</td>
                    </tr>

                    <!-- ÏòàÏïΩ Í∏∞Îä• (ÌöåÏõê Grade==M) -->
                    <c:choose>
                      <c:when test="${account.accountGrade eq 'M'}">
                        <tr style="border-bottom: 1px solid #ddd;">
                          <td colspan="2" style="text-align: center; padding: 10px;">
                            <div style="display: inline-flex; justify-content: center; align-items: center; gap: 10px;">
                              <select name="resKlassSelect" id="resKlassSelect">
                                <c:forEach var="date" items="${klassDate}">
                                  <option value="${date.klassDateNo}">
                                    ${date.klassStart} ~ ${fn:substring(date.klassEnd,11,19)}
                                  </option>
                                </c:forEach>
                              </select>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td colspan="2" style="text-align: center; padding: 10px;">
                            <div style="display: inline-flex; justify-content: center; align-items: center; gap: 10px;">
                              <span id="minusSpan">‚ûñ</span>
                              <span id="numberSpan">1</span>
                              <span id="plusSpan">‚ûï</span>
                              <button type="button" id="resBtn" name="resBtn"
                                style="background-color: #D1B5E0; color: white; border: 1px solid #d1c2dd; 
                                       border-radius: 8px; padding: 8px 16px; cursor: pointer;">
                                ÏòàÏïΩÌïòÍ∏∞
                              </button>
                              <button type="button" id="cnclBtn" name="cnclBtn"
                                style="background-color: #F0F2EF; color: white; border: 1px solid #ccc; 
                                       border-radius: 8px; padding: 8px 16px; cursor: pointer;">
                                ÏòàÏïΩÏ∑®ÏÜå
                              </button>
                            </div>
                          </td>
                        </tr>
                      </c:when>
                    </c:choose>

                    <tr style="border-bottom: 1px solid #ddd;">
                      <td colspan="2" style="text-align: center; padding: 10px;">
                        <c:choose>
                          <c:when test="${myLikeCount eq 0}">
                            <div class="icon">
                              <span class="icon-heart-o" id="unlikeToLike" style="color: #f44336; font-size: 20px;">
                                ${totalLikeCount}
                              </span>
                            </div>
                          </c:when>
                          <c:otherwise>
                            <div class="icon">
                              <span class="icon-heart" id="likeToUnlike" style="color: #f44336; font-size: 20px;">
                                ${totalLikeCount}
                              </span>
                            </div>
                          </c:otherwise>
                        </c:choose>
                      </td>
                    </tr>
                  </table>
                </li>
                <li>
                  <br>
                  <!-- Í≤åÏãúÍ∏Ä ÎÇ¥Ïö© -->
                  <div>
                    ${klass.klassTxt}
                  </div>
                </li>
              </ul>
            </div>

            <!-- üö® Ïã†Í≥† Î≤ÑÌäº -->
            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#exampleModal"
              style="position: absolute; top: 10px; right: 10px; font-size: 14px; 
                     padding: 6px 8px; width: 40px; height: 40px; line-height: 1; 
                     border-radius: 50%; display: flex; align-items: center; justify-content: center;">
              üö®
            </button>
            <div class="modal" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ïã†Í≥†ÌïòÍ∏∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <input type="radio" name="reportKlass" id="abuse" value="ÏöïÏÑ§">
                    <label for="abuse">ÏöïÏÑ§</label><br>
                    <input type="radio" name="reportKlass" id="hateSpch" value="ÎπÑÌïòÎ∞úÏñ∏">
                    <label for="hateSpch">ÎπÑÌïòÎ∞úÏñ∏</label><br>
                    <input type="radio" name="reportKlass" id="improperNickname" value="Î∂ÄÏ†ÅÏ†àÌïú ÎãâÎÑ§ÏûÑ">
                    <label for="improperNickname">Î∂ÄÏ†ÅÏ†àÌïú ÎãâÎÑ§ÏûÑ</label><br>
                    <input type="radio" name="reportKlass" id="adv" value="Í¥ëÍ≥†">
                    <label for="adv">Í¥ëÍ≥†</label>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-bs-dismiss="modal">Ï∑®ÏÜå</button>
                    <button type="button" class="btn-primary" id="reportBtn">Ïã†Í≥†</button>
                  </div>
                </div>
              </div>
            </div>
            <!-- üö® Ïã†Í≥† Î≤ÑÌäº ÎÅù -->

            <!-- Î¶¨Î∑∞ Î™©Î°ù -->
            <div style="width: 100%; max-width: 100%; margin: 20px auto; 
                        border: 1px solid #ddd; border-radius: 10px; padding: 10px;">
              <form>
                <table class="review_by_klass_list"
                  style="
                    width: 100%;
                    border-collapse: separate;
                    border-spacing: 0 5px;
                    text-align: center;
                    border: 1px solid #ddd;">
                    
                  <thead style="border-bottom: 2px solid #aaa; background-color: #D1B5E0;">
                    <tr style="border-bottom: 1px solid #ddd;">
                      <th style="width: 60px; padding: 8px;">No.</th>
                      <th style="width: 200px; padding: 8px;">Ï†úÎ™©</th>
                      <th style="width: 100px; padding: 8px;">ÎãâÎÑ§ÏûÑ</th>
                      <th style="width: 150px; padding: 8px;">ÏûëÏÑ±Ïùº</th>
                    </tr>
                  </thead>
                  <tbody>
                    <c:choose>
                      <c:when test="${not empty review}">
                        <c:forEach var="list" items="${review}" varStatus="vs">
                          <tr data-review-no="${list.reviewNo }" style="background-color: #E8DAEF; border-bottom: 1px solid #ddd;">
                            <td style="padding: 8px;">${vs.count}</td>
                            <td style="padding: 8px;">${list.reviewName}</td>
                            <td style="padding: 8px;">${list.accountNickname}</td>
                            <td style="padding: 8px;">${list.reviewRegDate}</td>
                          </tr>
                        </c:forEach>
                      </c:when>
                      <c:otherwise>
                        <tr style="background-color: #E8DAEF; border-bottom: 1px solid #ddd;">
                          <td colspan="4" style="padding: 8px;">
                            ÏûëÏÑ±Îêú Î¶¨Î∑∞Í∞Ä ÏóÜÏäµÎãàÎã§.
                          </td>
                        </tr>
                      </c:otherwise>
                    </c:choose>
                  </tbody>
                </table>
              </form>
            </div>
            <!-- Î¶¨Î∑∞ Î™©Î°ù ÎÅù -->

          </div><!-- row pt-md-4 ÎÅù -->
        </div><!-- col-xl-8 ÎÅù -->
      </div><!-- row ÎÅù -->
    </div><!-- container ÎÅù -->
  </section>
</div><!-- colorlib-main ÎÅù -->


<!-- Ï±ÑÌåÖ Ìå®ÎÑê (ÏõêÎ≥∏) -->
<!-- position: fixed; top: 100px; right: 20px; width: 300px; z-index: 999; -->

<!-- Ï±ÑÌåÖ Ìå®ÎÑê -->
<div style="
  position: fixed; 
  top: 100px; 
  right: 70px; 
  width: 380px; 
  z-index: 9999;
">
  <div class="card"
       style="
         border: 2px solid #D1B5E0; 
         border-radius: 10px;  
         box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
       ">

    <!-- Ïπ¥Îìú Ìó§Îçî (ÏßÑÌïú Î≥¥Îùº) -->
    <div class="card-header"
      style="
        background-color: #D1B5E0; 
        color: #fff; 
        font-weight: bold; 
        display: flex; 
        justify-content: space-between; 
        align-items: center;
      ">
      <span>Chat</span>
      <!-- ÎìúÎ°≠Îã§Ïö¥ (ÏÉàÎ°úÍ≥†Ïπ® Îì±) -->
      <div class="dropdown" style="position: relative;">
        <button type="button"
          class="btn btn-sm dropdown-toggle"
          style="
            background-color: #EBD1F3; 
            color: #333; 
            border: none; 
            padding: 4px 8px; 
            border-radius: 4px;
          "
          data-bs-toggle="dropdown"
          aria-expanded="false">
          ‚ñº
        </button>
        <ul class="dropdown-menu" style="min-width:120px;">
          <li>
            <a id="refreshBtn" class="dropdown-item" style="cursor:pointer">
              ÏÉàÎ°úÍ≥†Ïπ®
            </a>
          </li>
          <li>
            <a class="dropdown-item" target="_blank"
               href="https://www.istockphoto.com/kr/%EC%82%AC%EC%A7%84/cute-corgi-dog-in-a-wildflower-cage-sits-on-a-summer-sunny-meadow-gm1967994177-558259453">
              üòâÎπõÎÇòÎäî ÌïòÎ£®!üòâ
            </a>
          </li>
        </ul>
      </div>
    </div>
    <!-- Ïπ¥Îìú Ìó§Îçî ÎÅù -->

    <!-- Ïπ¥Îìú Î∞îÎîî (Ï±ÑÌåÖ ÎÇ¥Ïö©) -->
    <div class="card-body" id="chatBody"
      style="
        display: flex; 
        height: 400px; 
        overflow-y: auto; 
        justify-content: center; 
        align-items: center;
      ">
      <!-- Ï±ÑÌåÖÎ∞© ÏûÖÏû•ÌïòÍ∏∞ Î≤ÑÌäº (Ï¥àÍ∏∞) -->
      <button type="button" id="chatStartBtn"
        style="
          background-color: #E8DAEF; 
          color: #2c3e50; 
          border: 1px solid #d1c2dd; 
          border-radius: 8px; 
          padding: 8px 16px; 
          cursor: pointer;
        ">
        Ï±ÑÌåÖÎ∞© ÏûÖÏû•ÌïòÍ∏∞
      </button>
      <!-- Ïã§Ï†ú Ï±ÑÌåÖ Î©îÏãúÏßÄ Î™©Î°ù (Ï≤òÏùåÏóî display:none) -->
      <ul class="chat" id="chatUl"
        style="
          list-style:none; 
          margin:0; 
          padding:0; 
          display:none;
        ">
        <!-- JSÏóêÏÑú Î©îÏãúÏßÄ append -->
      </ul>
    </div>
    <!-- Ïπ¥Îìú Î∞îÎîî ÎÅù -->

    <!-- Ïπ¥Îìú Ìë∏ÌÑ∞ (Î©îÏãúÏßÄ ÏûÖÎ†•) -->
    <div class="card-footer" style="padding: 8px; background-color: #f0f0f0;">
      <div style="display: flex;">
        <input id="sendInput" type="text" placeholder="Î©îÏÑ∏ÏßÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."
          style="
            flex: 1; 
            padding: 6px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            margin-right: 8px;
          ">
        <button type="button" id="sendBtn"
          style="
            background-color: #f8e1f8; 
            border: 1px solid #dcb3dc; 
            color: #333; 
            border-radius: 4px; 
            padding: 6px 12px; 
            cursor: pointer;
          ">
          Send
        </button>
      </div>
    </div>
  </div>
</div>



<script>
  // ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏ Î≥ÄÏàòÎäî Î¨∏ÏûêÏó¥Î°ú Î∞õÏïÑÏÑú ÏóêÎü¨ Î∞©ÏßÄ
  const klassNo = "${klass.klassNo}";
  const accountNo = "${account.accountNo}";
  const res_no = "${res_no}"; // ÏòàÏïΩÎ≤àÌò∏(ÏóÜÏúºÎ©¥ "")

  // === Ïã†Í≥†ÌïòÍ∏∞ ===
  $('#reportBtn').click(function(){
    let rp = $('.modal-body input[name="reportKlass"]:checked').val();
    console.log(rp, klassNo, accountNo);
    const rpCheck = confirm("Ïã†Í≥†ÌïòÏãúÍ≤†ÏäµÎãàÍπå?");
    if(rpCheck){
      $.ajax({
        url : "/klassReport",
        type : "post",
        data : {"klass_no": klassNo, "account": accountNo, "report_klass_txt": rp},
        dataType : "json",
        success : function(data){
          alert(data.res_msg);
          if(data.res_code == "200"){
            location.href="/klassBoardList";
          } else {
            location.href="/";
          }
        }
      });
    }
  });
  
  // === ÎåìÍ∏Ä ÌÅ¥Î¶≠Ïãú Î¶¨Î∑∞ ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ ÎÑòÍπÄ === 
  $('.review_by_klass_list tr').click(function(){
		const reviewNum = $(this).data('review-no');
		if(reviewNum != null && reviewNum >0){
			location.href='/reviewDetail?review_no='+reviewNum;
		}
	})	
  

  // === ÏÇ≠Ï†ú ===
  $('#deleteBtn').click(function(){
    const attachNo = "${klass.attachNo}";
    const check = confirm("ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?");
    if(check){
      $.ajax({
        url : "klassBoardDelete",
        type : "post",
        data : {"klass_no": klassNo, "attach_no": attachNo},
        dataType : "JSON",
        contentType : "application/x-www-form-urlencoded; charset=UTF-8",
        success : function(data){
          if(data.res_code == "200"){
            alert(data.res_msg);
            location.href="/klassBoardList";
          } else {
            alert(data.res_msg);
            location.href='/klassDetail?klass_no='+klassNo;
          }
        }
      });
    }
  });

  // === +/- Ïù∏Ïõê ===
  $('#minusSpan').click(function(){
    let downPpl = $('#numberSpan').text();
    let downResCnt = Number(downPpl);
    if(downResCnt > 1){
      downResCnt--;
      $('#numberSpan').text(downResCnt);
    }
  });
  $('#plusSpan').click(function(){
    let upPpl = $('#numberSpan').text();
    let upRescnt = Number(upPpl);
    if(upRescnt < 4){
      upRescnt++;
      $('#numberSpan').text(upRescnt);
    }
  });

  // === ÏòàÏïΩÌïòÍ∏∞ ===
  $('#resBtn').click(function(){
    const klassDateNo = $('#resKlassSelect').val();
    const resPpltxt = $('#numberSpan').text();
    let resPpl = Number(resPpltxt);
    const ck = confirm("ÏòàÏïΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?");
    if(ck){
      $.ajax({
        url : "/klassReservation",
        type : "post",
        data : {"klass_date_no": klassDateNo, "res_ppl": resPpl, "klass_no": klassNo},
        dataType: "json",
        success : function(data){
          alert(data.res_msg);
          if(data.res_code == "200"){
            window.location.href = data.paymentResponse.next_redirect_pc_url;
          } else {
            // ÏòàÏïΩ Ïã§Ìå® Ïãú Ï≤òÎ¶¨
          }
        },
        error : function(a,b,c){
          alert('Í≤∞Ï†ú ÏöîÏ≤≠ Ï§ë Ïò§Î•ò Î∞úÏÉù');
        }
      });
    }
  });

  // === ÏòàÏïΩÏ∑®ÏÜå ===
  $('#cnclBtn').click(function(){
	  
    if(!res_no || res_no == "" || res_no == "null"){
      alert("ÏòàÏïΩ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.");
      return;
    }
    const deleteCheck = confirm("ÏòàÏïΩ Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?");
    if(deleteCheck){
      $.ajax({
        url: "/cnclReservation",
        type:"post",
        data:{"res_no": res_no},
        dataType:"json",
        success:function(data){
          alert(data.res_msg);
          if(data.res_code == "200"){
            location.href="/klassBoardList";
          } else {
            location.href='/';
          }
        }
      });
    }
  });

  // === Ï¢ãÏïÑÏöî(Like) ===
  $(function(){
    let unlikeToLike = "unlikeToLike";
    let likeToUnlike = "likeToUnlike";
    // Ï¢ãÏïÑÏöîX -> Ï¢ãÏïÑÏöîO
    $(document).on('click', '#unlikeToLike', function(){
      $.ajax({
        url : "/klassLikeChange",
        type : "post",
        data : {"klass_no": klassNo, "like": unlikeToLike},
        dataType : 'json',
        success : function(data){
          if(data.res_code == "200"){
            alert('Ï¢ãÏïÑÏöî!');
            $('#unlikeToLike').text(data.newTotalLikeCount);
            $('#unlikeToLike').attr("id","likeToUnlike")
                              .removeClass('icon-heart-o')
                              .addClass('icon-heart');
          } else {
            alert('Ïò§Î•ò. ÌôàÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.');
            location.href="/";
          }
        },
        error : function(){ alert('ajax Ïã§Ìå®1'); }
      });
    });
    // Ï¢ãÏïÑÏöîO -> Ï¢ãÏïÑÏöîX
    $(document).on('click', '#likeToUnlike', function(){
      $.ajax({
        url : "/klassLikeChange",
        type : "post",
        data : {"klass_no": klassNo, "like": likeToUnlike},
        dataType : 'json',
        success : function(data){
          if(data.res_code == "200"){
            alert('Ï¢ãÏïÑÏöîÎ•º Ï∑®ÏÜåÌï©ÎãàÎã§.');
            $('#likeToUnlike').text(data.newTotalLikeCount);
            $('#likeToUnlike').attr("id","unlikeToLike")
                              .removeClass('icon-heart')
                              .addClass('icon-heart-o');
          } else {
            alert('Ïò§Î•ò. ÌôàÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.');
            location.href="/";
          }
        },
        error : function(){ alert('ajax Ïã§Ìå®2'); }
      });
    });
  });

  // === Ï±ÑÌåÖ Í∏∞Îä• ===
  // AJAX Î∂àÎü¨Ïò§Í∏∞
  const chatAjax = function(klassNoPara, chatTxtPara, klassAccountNoPara){
    return $.ajax({
      url : "/klassChat",
      type : "post",
      data : {
        "chatTxt": chatTxtPara,
        "klassAccountNo": klassAccountNoPara,
        "klassNo": klassNoPara
      },
      dataType : 'json',
      success : function(data){
        $('#chatUl').html('');
        if(data.res_code == "200"){
          let val = "";
          for(let i=0; i<data.chatList.length; i++){
        	  if(data.chatList[i].includes("(Member)")){
					val += '<li class="left clearfix"><div class="chat-body clearfix" style="text-align: right"><strong class="primary-font">' + '</strong><p style="text-align: right">' + data.chatList[i] + '</p></div></li>';									
				} else{
					val += '<li class="right clearfix"><div class="chat-body clearfix" style="text-align: left"><strong class="primary-font">' + '</strong><p style="text-align: left">' + data.chatList[i] + '</p></div></li>';
				}
			}
          $('#chatUl').append(val).show();
        } else {
          alert('Ïò§Î•ò. ÌôàÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.');
          location.href="/";
        }
      },
      error : function(){
        alert('Ï±ÑÌåÖ Î∂àÎü¨Ïò§Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
      }
    });
  };

  // Ï±ÑÌåÖÎ∞© ÏûÖÏû•
  $(document).on('click', '#chatStartBtn', function(){
    alert('Ï±ÑÌåÖÎ∞©Ïóê ÏûÖÏû•Ìï©ÎãàÎã§!');
    $('#chatStartBtn').hide();
    // 3Ï¥à Í∞ÑÍ≤©ÏúºÎ°ú ÏÉàÎ°úÍ≥†Ïπ®
    setInterval(function(){
      $('#refreshBtn').click();
    }, 3000);
  });

  // Ï±ÑÌåÖ Ï†ÑÏÜ° (Î≤ÑÌäº)
  $(document).on('click', '#sendBtn', function(){
    let klassAccountNo = "${klass.accountNo}";
    let chatTxt = $('#sendInput').val();
    $('#chatStartBtn').hide();
    if(chatTxt == ''){
      alert('Î©îÏÑ∏ÏßÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
      return;
    }
    if(chatTxt.includes("(Host)") || chatTxt.includes("(Member)")){
      alert('Í∏àÏπôÏñ¥ (Host), (Member) Í∞Ä Îì§Ïñ¥ÏûàÏäµÎãàÎã§.');
      return;
    }
    chatAjax(klassNo, chatTxt, klassAccountNo).done(function(){
      $('#sendInput').val('');
      $('#chatBody').scrollTop($('#chatBody')[0].scrollHeight);
    });
  });

  // Ï±ÑÌåÖ Ï†ÑÏÜ° (Enter)
  $(document).on('keyup', '#sendInput', function(e){
    if(e.key === 'Enter'){
      $('#sendBtn').click();
    }
  });

  // Ï±ÑÌåÖ ÏÉàÎ°úÍ≥†Ïπ®
  $(document).on('click', '#refreshBtn', function(){
    chatAjax(klassNo).done(function(){
      $('#chatBody').scrollTop($('#chatBody')[0].scrollHeight);
    });
  });
</script>
</body>
</html>